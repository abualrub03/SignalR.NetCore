@model ViewModel.HomePageViewModel
@{
    ViewData["Title"] = "_Chat";
    Layout = "_DashboardLayout";
}
<script src="~/lib/microsoft/signalr/dist/browser/signalr.js"></script>

@section scripts{
    <script type="text/javascript">
		setInterval(function () {
			$.ajax({
				url: "/Home/CheckActivity",
				method: "POST",
				data: {
					Id: "@Model.accounts[0].Id"	,
				},
				success: function (data) {
					console.log(data);
					
					if ( data == 1) {
						console.log("1");
						document.getElementById("statusChat").innerHTML =
							`<i class="material-icons online">fiber_manual_record</i>`;
						document.getElementById("ActiveInActive").innerHTML =
							`<span>Active Now</span>`;

						console.log("1");
					} else {
						console.log("0");
						document.getElementById("statusChat").innerHTML =
							`<i class="material-icons offline">fiber_manual_record</i>`;
						document.getElementById("ActiveInActive").innerHTML =
							`<span>Inactive</span>`;
						console.log("0");
					}
					
				
				},
				error: function (error) {
					consoe.log("error");
				}
			});
			console.log("enterval");
		}, 0.1 * 60 * 1000);
		function recevedMessage(user,message) {
			if (@Model.accounts[0].Id == user) {
				document.getElementById("msgContainer").innerHTML +=
					`<div class="message">
						<img class="avatar-md" src="/img/avatars/avatar-female-5.jpg" data-toggle="tooltip" data-placement="top" title="Keith" alt="avatar">
						<div class="text-main">
							<div class="text-group">
								<div class="text">
									<p> ` + message +  ` </p>
								</div>
							</div>

						</div>
					</div>`;
				}
		}
		function sentMessage(message) {
			document.getElementById("msgContainer").innerHTML +=
				`<div class="message me">
					<div class="text-main">
						<div class="text-group me">
							<div class="text me">
								<p> ` + message + ` </p>
							</div>
						</div>
					</div>
				</div>`;
		}

        document.getElementById("sendToUser").addEventListener("click", function (event) {
			var message = document.getElementById("messageInput").value;
			connection.invoke("SendToUser", @Model.account.Id , @Model.accounts[0].Id ,message ).catch(function (err) {
                return console.error(err.toString());
            });
            event.preventDefault();
			sentMessage(message);
        });
        
    </script>
}
<div class="chat" id="chat1">
	<div class="top" style="background-color:lightskyblue">
		<div class="container">
			<div class="col-md-12">
				<div class="inside">
					<a href="#"><img class="avatar-md" src="/img/avatars/avatar-female-1.jpg" data-toggle="tooltip" data-placement="top" title="Keith" alt="avatar"></a>
					<div class="status" id="statusChat">
						@if(Model.accounts[0].IsActive == 1)
						{
							<i class="material-icons online">fiber_manual_record</i>

						}
						else
						{
							<i class="material-icons offline">fiber_manual_record</i>
						}
					</div>
					<div class="data">
						<h5><a href="#">@Model.accounts[0].FullName</a></h5>
						<span id="ActiveInActive">
						@if (Model.accounts[0].IsActive == 1)
						{
							<span>Active now</span>
						}
						else
						{
							<span>Inactive</span>
							}
						</span>
						
					</div>
					<!-- <button class="btn connect d-md-block d-none" name="1"><i class="material-icons md-30">phone_in_talk</i></button>
					<button class="btn connect d-md-block d-none" name="1"><i class="material-icons md-36">videocam</i></button>
					<button class="btn d-md-block d-none"><i class="material-icons md-30">info</i></button>
					<div class="dropdown">
						<button class="btn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="material-icons md-30">more_vert</i></button>
						<div class="dropdown-menu dropdown-menu-right">
							<button class="dropdown-item connect" name="1"><i class="material-icons">phone_in_talk</i>Voice Call</button>
							<button class="dropdown-item connect" name="1"><i class="material-icons">videocam</i>Video Call</button>
							<hr>
							<button class="dropdown-item"><i class="material-icons">clear</i>Clear History</button>
							<button class="dropdown-item"><i class="material-icons">block</i>Block Contact</button>
							<button class="dropdown-item"><i class="material-icons">delete</i>Delete Contact</button>
						</div>
					</div>-->
				</div>
			</div>
		</div>
	</div>
	<div class="content" id="content">
		<div id="msgContainer" class="container">
			@foreach(var i in Model.listMessages)
			{
				if(i.messageSenderId == Model.account.Id)
				{
					<div class="message me">
						<div class="text-main">
							<div class="text-group me">
								<div class="text me">
									<p> @i.messageContent </p>
								</div>
								
							</div>
							<span>@i.messageDateTime</span>
						</div>
					</div>
				}
				else
				{
					<div class="message">
						<img class="avatar-md" src="/img/avatars/avatar-female-5.jpg" data-toggle="tooltip" data-placement="top" title="Keith" alt="avatar">
						<div class="text-main">
							<div class="text-group">
								<div class="text">
									<p> @i.messageContent </p>
								</div>
								
							</div>
							<span>@i.messageDateTime</span>
						</div>
					</div>
				}
			}
		</div>
	</div>
	<div class="container">
		<div class="col-md-12">
			<div class="bottom">
				<div class="position-relative w-100">
					<textarea class="form-control" id="messageInput" placeholder="Start typing for reply..." rows="1"></textarea>
					<button type="button" id="sendToUser" class="btn send"><i class="material-icons">send</i></button>
				</div>
			</div>
		</div>
	</div>
</div>